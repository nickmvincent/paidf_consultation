<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Flywheels and Public AI - 5&nbsp; Flywheel design space</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./01f_ethics_compliance.html" rel="next">
<link href="./01d_leverage.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01a_intro.html">Concepts &amp; Rationale</a></li><li class="breadcrumb-item"><a href="./01e_options_for_flywheel.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Flywheel design space</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Flywheels and Public AI</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Concepts &amp; Rationale</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01a_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01b_why.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Why collect data?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01c_pipeworks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">A Democratic Data Pipeworks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01d_leverage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Flywheels and Bargaining Power</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01e_options_for_flywheel.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Flywheel design space</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01f_ethics_compliance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ethics and Compliance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01g_upstream.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Upstream data and data contribution</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Case Study: Low friction peer production</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2a_mvp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The OpenWebUI Action MVP</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2b_life_of_a_chat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The Life of a Chat</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2c_terms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Terms and Privacy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2d_faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Public AI Data Flywheel ‚Äî User FAQ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2e_code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Code</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Updating this book</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3a_contributing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Contributing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3b_ai_guidelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Guidelines for Using AI</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3c_future_directions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Future Directions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix1_llm_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Appendix 1: LLM Data Schemas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix2_prefsig.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Appendix 2 ‚Äî Preference Signals for AI Data Use (CC signals + IETF AI Preferences)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix3_example_legalterms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Appendix 3: LLM Policy Docs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix4_diffable_terms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Diffable Terms</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#purpose-of-this-section" id="toc-purpose-of-this-section" class="nav-link active" data-scroll-target="#purpose-of-this-section"><span class="header-section-number">5.1</span> Purpose of this section</a></li>
  <li><a href="#general-overview-of-approaches-to-flywheels" id="toc-general-overview-of-approaches-to-flywheels" class="nav-link" data-scroll-target="#general-overview-of-approaches-to-flywheels"><span class="header-section-number">5.2</span> General overview of approaches to flywheels</a></li>
  <li><a href="#must-have-elements-of-a-flywheel" id="toc-must-have-elements-of-a-flywheel" class="nav-link" data-scroll-target="#must-have-elements-of-a-flywheel"><span class="header-section-number">5.3</span> Must-have elements of a flywheel</a></li>
  <li><a href="#some-categories-of-architectural-models" id="toc-some-categories-of-architectural-models" class="nav-link" data-scroll-target="#some-categories-of-architectural-models"><span class="header-section-number">5.4</span> Some Categories of Architectural Models</a>
  <ul class="collapse">
  <li><a href="#standard-privateco-web-app" id="toc-standard-privateco-web-app" class="nav-link" data-scroll-target="#standard-privateco-web-app"><span class="header-section-number">5.4.1</span> Standard ‚ÄúPrivateCo‚Äù Web App</a></li>
  <li><a href="#gitwiki-platform" id="toc-gitwiki-platform" class="nav-link" data-scroll-target="#gitwiki-platform"><span class="header-section-number">5.4.2</span> Git/Wiki Platform</a></li>
  <li><a href="#web-app-with-intuitive-actions-that-wrap-git-style-contributions" id="toc-web-app-with-intuitive-actions-that-wrap-git-style-contributions" class="nav-link" data-scroll-target="#web-app-with-intuitive-actions-that-wrap-git-style-contributions"><span class="header-section-number">5.4.3</span> Web app with intuitive actions that ‚Äúwrap‚Äù Git-style contributions</a></li>
  <li><a href="#browser-extension" id="toc-browser-extension" class="nav-link" data-scroll-target="#browser-extension"><span class="header-section-number">5.4.4</span> Browser Extension</a></li>
  <li><a href="#federated-learning-model" id="toc-federated-learning-model" class="nav-link" data-scroll-target="#federated-learning-model"><span class="header-section-number">5.4.5</span> Federated Learning Model</a></li>
  <li><a href="#other-experimental-approaches" id="toc-other-experimental-approaches" class="nav-link" data-scroll-target="#other-experimental-approaches"><span class="header-section-number">5.4.6</span> Other experimental approaches</a></li>
  </ul></li>
  <li><a href="#frontier-approaches-data-cooperatives-federated-learning-and-more" id="toc-frontier-approaches-data-cooperatives-federated-learning-and-more" class="nav-link" data-scroll-target="#frontier-approaches-data-cooperatives-federated-learning-and-more"><span class="header-section-number">5.5</span> Frontier approaches: data cooperatives, federated learning, and more</a>
  <ul class="collapse">
  <li><a href="#interactions-between-these-flywheels" id="toc-interactions-between-these-flywheels" class="nav-link" data-scroll-target="#interactions-between-these-flywheels"><span class="header-section-number">5.5.1</span> Interactions between these flywheels</a></li>
  <li><a href="#transitioning-for-opt-in-flywheel-to-federated-learning" id="toc-transitioning-for-opt-in-flywheel-to-federated-learning" class="nav-link" data-scroll-target="#transitioning-for-opt-in-flywheel-to-federated-learning"><span class="header-section-number">5.5.2</span> Transitioning for opt-in flywheel to federated learning</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01a_intro.html">Concepts &amp; Rationale</a></li><li class="breadcrumb-item"><a href="./01e_options_for_flywheel.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Flywheel design space</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Flywheel design space</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>Key insight: There is a broad spectrum of technical implementation of the flywheel, ranging from traditional database-on-a-company-server to low-friction-peer-production (our preferred MVP) to radical approaches (e.g.&nbsp;truly federated data access).</p>
</blockquote>
<section id="purpose-of-this-section" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="purpose-of-this-section"><span class="header-section-number">5.1</span> Purpose of this section</h2>
<p>This section gives more context about the many ways we might build flywheels, and lays out alternative governance paths and a future work (in particular, a focus on futures that involve healthy data markets, data intermediaries, federated learning, etc.)</p>
<p>We also discuss why we think an approach that includes a minimal retention frontend + opt-in flywheel platform can serve as a pragmatic bridge to more advanced approaches. For instance, we can use the patterns and concepts discussed here to move towards independently governed data co-ops, eventual federated learning, etc.</p>
</section>
<section id="general-overview-of-approaches-to-flywheels" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="general-overview-of-approaches-to-flywheels"><span class="header-section-number">5.2</span> General overview of approaches to flywheels</h2>
<p>First, let‚Äôs lay out a toy model of data ‚Äúcreation‚Äù and ‚Äúflow‚Äù (this will come up again Part 2, when we walk through the flow for a real flywheel app).</p>
<p>In <a href="01b_why.html" class="quarto-xref"><span>Chapter 2</span></a> we talked about the numerous combinations of sensors, forms, task settings, social structure from institutions, communities, etc. that might exist, and in the Appendix we discuss a number of formats and types of data for LLMs in particular.</p>
<p>To summarize, an AI developers might collect or use some of the following kinds of data:</p>
<ul>
<li>Simple Signal: Binary feedback (<code>üëç</code>/<code>üëé</code>), star ratings, or flags</li>
<li>Annotated Conversation: Full chat with user corrections, ratings, or notes</li>
<li>Preference Pair: A/B comparisons between responses</li>
<li>Examples: User-created prompts and ideal responses</li>
<li>Structured Feedback: Form-based input (error type, severity, correction)</li>
<li>Multimodal Bundle: Text + images + voice + metadata</li>
<li>More advanced structured data ‚Ä¶</li>
</ul>
<p>Further, the creation of data could be prompted at several points in time:</p>
<ul>
<li>Proactive: User initiates contribution unprompted (e.g., ‚ÄúShare this chat‚Äù button)</li>
<li>Reactive: System prompts based on signals (e.g., after trigger word, patterns in usage behavior, ask ‚ÄúWhat went wrong?‚Äù)</li>
<li>Passive: Automatic collection with prior consent (e.g., telemetry, browser extension)</li>
<li>Scheduled: Regular prompts (e.g., weekly ‚Äúbest conversations‚Äù review)</li>
<li>Task-Based: Specific requests for data types (e.g., ‚ÄúHelp us improve math responses‚Äù)</li>
</ul>
<p>This choice will likely impact the level of ‚Äúfriction‚Äù users experience, roughly:</p>
<ul>
<li>Zero-Friction: Purely passive</li>
<li>Almost zero-friction: Purely passive with some regular re-consenting process (monthly or yearly ‚Äúcheckup‚Äù on sharing settings)</li>
<li>Low-Friction: One-click actions with no interruption</li>
<li>Medium-Friction: Multi-click actions or actions that redirect to separate interface</li>
<li>High-Friction: Multi-step process, account creation, or technical skills required</li>
</ul>
<p>Data might also be processed at one or more points in time. In practice, there is likely be some degree of ‚Äúprocessing‚Äù at various steps, but it is important to clarify this to users. This might involve</p>
<ul>
<li>Pre-submission: Client-side processing before data leaves user‚Äôs device</li>
<li>On-submission: Real-time processing during the contribution flow</li>
<li>Post-submission: Batch processing after data is received</li>
<li>Pre-publication: Review and processing before making data public</li>
<li>On-demand: Processing happens when data is accessed/downloaded</li>
</ul>
<p>So, person visits an AI interface (e.g.&nbsp;visits a chatbot product on a website). They sit down, enter a prompt, and then react to the Output (take the information and do something with it, follow up, leave positive or negative feedback, etc.). This is our canonical object of interest: a prompt (‚ÄúInput‚Äù), response (‚ÄúOutput‚Äù), and optional follow up data (feedback, more queries and responses, etc.).</p>
<p>Typically, this data must live, for some time, on the user‚Äôs device. It must also be processed by an AI model (‚Äúinference‚Äù), which involves sending a payload to a hosted service or some local endpoint (if e.g.&nbsp;user is running open weights on their own device). It may or may not be stored on the server/system (we‚Äôll use these interchangeably for now to refer to all the devices controlled by the organization running each module) where the interface is hosted. It may or may not be stored by the server/system where the model is hosted. And finally, a flywheel may send that data to a third location.</p>
<p>This final data could live in a centralized database (e.g.&nbsp;traditional relational database), a public repository (e.g.&nbsp;GitHub, HuggingFace), totally local, or even in some kind of distributed network (IPFS, BitTorrent).</p>
<p>Finally, the resulting flywheel-produced data might be accessed in a number of ways: direct download, API access, a static site with download features, some kind of gated access (using HuggingFace, or other impelmentation), some hybrid of the above, some kind of Wikimedia Enterprise package, etc.</p>
<p>So we have five useful questions for classifying flywheel designs:</p>
<ul>
<li>Where data lives: ‚Ä¶</li>
<li>When prompted: ‚Ä¶</li>
<li>When processed: ‚Ä¶</li>
<li>How accessed: ‚Ä¶</li>
<li>Friction level: ‚Ä¶</li>
</ul>
</section>
<section id="must-have-elements-of-a-flywheel" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="must-have-elements-of-a-flywheel"><span class="header-section-number">5.3</span> Must-have elements of a flywheel</h2>
<p>Summarizing the above once more, a flywheel designer must:</p>
<ul>
<li>choose to either share-by-default or not-share-by-default (note we use this language as ‚Äúopt in‚Äù and ‚Äúopt out‚Äù can actually get confusing in these discussions); if we just say ‚Äúthat app uses opt-in‚Äù, it can be unclear if that means users are opted in by default or users must opt in to contribute). Is the default behavior upon first sign up or first app use for the initial data to be shared, or not?
<ul>
<li>share-by-default means that the actual infrastructure of the app is <em>not</em> decentralized (for a truly decentralized app, e.g.&nbsp;an interface + model I run entirely locally, share-by-default is impossible)</li>
<li>not-share-by-default allows for several avenues for opting in
<ul>
<li>App is still centralized, but user toggles a setting. Must trust the operator in this case.</li>
<li>Some additional software running on the user‚Äôs machine does the contributions at user‚Äôs behest (browser extension that hits API endpoint when user asks it to)
<ul>
<li>But the user is responsible for installing this software</li>
</ul></li>
<li>User does the sharing manually (user exports and then upload their export; contributions are made via manual peer production-style contributions)</li>
</ul></li>
</ul></li>
<li>choose a level of transparency. Does the app interface, the settings page, the browser extension, etc. tell the user exactly what is happening to data and how it might be used?</li>
<li>choose how to motivate users. What kinds of motivations do UX choices appeal to? Are users paid? Is there a reputation system for contributions?</li>
<li>choose whether to process contributions. For what: PII? Security concerns? Sensitive content or values conflicts? If yes, choose when to process (on user‚Äôs device, as part of some ‚Äúapproval process‚Äù, at regular intervals after data has already been published)</li>
<li>choose how to share or publish contributions</li>
</ul>
<p>If designed carefully, many of these flywheel approaches can be integrated together.</p>
</section>
<section id="some-categories-of-architectural-models" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="some-categories-of-architectural-models"><span class="header-section-number">5.4</span> Some Categories of Architectural Models</h2>
<p>With all these design choices in mind, it will be useful to describe the general approaches we might take to build a data flywheel.</p>
<section id="standard-privateco-web-app" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="standard-privateco-web-app"><span class="header-section-number">5.4.1</span> Standard ‚ÄúPrivateCo‚Äù Web App</h3>
<p>An obvious option is to simply build a hosted ‚Äústandard‚Äù ‚ÄúPrivateCo‚Äù / start-up style web app. If Netflix is successful because of its flywheel, why not just build a public AI data flywheel that looks like a private tech company‚Äôs product from a technical perspective? Indeed, in some contexts it may make sense share-by-default and simply use the data generated by users directly for R&amp;D (training, eval, etc.).</p>
<p>In this case, the ‚Äúflywheels‚Äù just reads data from the existing production database. While one could argue that the Terms of Service for many existing tech products do mean that users have gone through a kind of informed consent process, there are also serious downsides to the status quo. Many would argue that standard practice in tech (long, difficult to read Terms of Service and Privacy policy documents; opacity about exact details of data collection and usage; general challenges in conveying the complexity of modern data pipelines) make it hard for the standard PrivateCo Web App model to offer truly informed consent for data contribution. (For more on general issues with ToS, see e.g.&nbsp;<a href="https://dl.acm.org/doi/10.1145/2818048.2819931">Fiesler, Lampe, and Bruckman 2016</a> #todo add more of the ‚Äúclassics‚Äù of this genre.)</p>
<p>While some users might even prefer this approach, we believe this would <strong>not</strong> be a good starting place for a public AI data flywheel. We also believe it‚Äôs important to communicate to users how the public AI interface differs standard practices (for instance, how does a public AI model differ in terms of data use from e.g.&nbsp;using ChatGPT, Gemini, or AI overviews via search).</p>
<p>The defining characteristics of this approach is that data is held by a private entity at all times. Under this approach, we can collect all types of signals, mix proactive and reactive data collection, use telemetry freely, process data whenever we want. It‚Äôs highly likely under this approach, data from a flywheel would live in centralized, privately governed database.</p>
<p>Answering each of the questions posed above:</p>
<ul>
<li>Where data lives: private database</li>
<li>When prompted: flexible</li>
<li>When processed: flexible</li>
<li>How accessed: flexible; likely API</li>
<li>Friction level: flexible; likely low</li>
</ul>
<p>It‚Äôs also likely we would want to follow corporate practices in locking down the final data, which makes this a bad choice for maximizing publicly visible output. Put simply: while an interesting idea in theory, we probably can‚Äôt run an AI product that has a prod database that is openly readable by the public.</p>
<p>Within the broad umbrella of taking a ‚ÄúStandard PrivateCo Web App‚Äù approach to data flywheels, some archetypes might include:</p>
<ul>
<li>Telemetry heavy approach (imagine an LLM chat app with no feedback buttons, but lots of data is collected re: dwell time, conversation length, user responses, etc.)</li>
<li>Feedback heavy approach (imagine an LLM chat app where the UX is heavily focused on asking users to use thumbs up / thumbs down buttons, or presenting users with frequent A/B test responses)</li>
<li>Hybrid approach</li>
</ul>
<section id="turn-sharing-off-by-default-but-offer-a-one-click-opt-in" class="level4" data-number="5.4.1.1">
<h4 data-number="5.4.1.1" class="anchored" data-anchor-id="turn-sharing-off-by-default-but-offer-a-one-click-opt-in"><span class="header-section-number">5.4.1.1</span> Turn sharing off by default, but offer a one click opt in</h4>
<p>One approach to building a flywheel that retains some of the benefits of the ‚Äútraditional‚Äù model is to simply ask users to opt in with one click to make all data open for R&amp;D, and perhaps even public. This approach might lead to a smaller pool of users, but a big pool of data from the users who are willing to make the large commitment to opt in.</p>
<p>This would mean the service operates in a privacy maximizing fashion for most users, but for users who opt-in, researchers with access can ‚Äúread from the production database‚Äù as if they were doing research setting (of course, large private organizations do lots of internal security practices and researchers are typically not <em>literally</em> reading from prod without multiple stages of approval, anonymization, etc.)</p>
</section>
</section>
<section id="gitwiki-platform" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="gitwiki-platform"><span class="header-section-number">5.4.2</span> Git/Wiki Platform</h3>
<p>Another option to build a ‚Äúvery active flywheel‚Äù (that arguably stretches the definition because friction will be very high) is to just use peer production or version control software (a ‚Äúwiki‚Äù like Wikipedia or ‚Äúgit‚Äù approach) and just ask people to make their contributions using existing contribution avenues (for instance, ‚Äúediting‚Äù a wiki page or making a ‚Äúpull request‚Äù to a version-controlled git repository).</p>
<p>As a very simple and concrete example, this might mean creating a ‚Äúflywheel‚Äù that starts as a blank GitHub repository or blank Wiki page, with lots of open calls and personal asks for people to make ‚Äúpull requests‚Äù to just ‚Äústick some data into the repo‚Äù. Over time, if people decide to contribute, you might end up with some high quality content in the repo, though this is likely to very dependent on who contributes, how motivated they are, etc.</p>
<p>If we choose this approach, we do likely constrain our answers to the above design questions:</p>
<ul>
<li>Where data lives: Public repository</li>
<li>When prompted: Proactive (user initiates)</li>
<li>When processed: Pre-submission (user does it) + optional CI/CD validation</li>
<li>How accessed: Probably via direct download (e.g.&nbsp;download raw data from GitHub), options to add web interface</li>
<li>Friction level: High (technical knowledge required)</li>
</ul>
<p>This approach has maximum transparency, built-in versioning, and low cost. But, it is likely to exclude non-technical users and has very high friction even for technical users.</p>
<p>Example Stack: some combo of MediaWiki, GitHub, GitLab, HuggingFace + CI/CD validation</p>
<section id="export-based-approach" class="level4" data-number="5.4.2.1">
<h4 data-number="5.4.2.1" class="anchored" data-anchor-id="export-based-approach"><span class="header-section-number">5.4.2.1</span> Export-based approach</h4>
<p>A relate idea is to build a flywheel that leverages existing export features and export mechanisms. Instead of adding feedback buttons or telemetry, flywheel designers could simply create a static site that lets users manually upload exported data from various apps. This would require manual effort (and some friction could be reduced via careful attention to UX, adding features to help standardize data, etc.) but could be powerful in jurisdictions with portability/export rights.</p>
<p>This could lead to something that looks very much like a peer production process, but with a heavily simplified set of actions (primarily, just export, perhaps with some filtering or curation, and upload).</p>
</section>
</section>
<section id="web-app-with-intuitive-actions-that-wrap-git-style-contributions" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="web-app-with-intuitive-actions-that-wrap-git-style-contributions"><span class="header-section-number">5.4.3</span> Web app with intuitive actions that ‚Äúwrap‚Äù Git-style contributions</h3>
<p>The option described in Part 2 of this mini-book is to use a Git/Wiki approach, but build a web app with features that allow users to take low friction in-app actions (clicking a special button, entering special command, etc.) that writes to a Wiki / Git repo on the contributor‚Äôs behalf. We could also build a system so that users can effectively commit data to the source control / wiki system automatically (e.g., ‚ÄúEvery day, run an anonymization script on my chat history and then write the output as a new file to a shared, version-controlled server‚Äù). In other words, these are ways to ‚Äúcontribute data as if it were a GitHub PR or a Wikipedia edit‚Äù without having to learn the exact interfaces of GitHub or Wikipedia.</p>
<ul>
<li>Where data lives: Public repository</li>
<li>When prompted: Proactive or reactive</li>
<li>When processed: On-submission via serverless function</li>
<li>How accessed: Git access + static site generation</li>
<li>Friction level: Low (automated complexity)</li>
<li>Pros: Transparency + usability, serverless scaling</li>
<li>Cons: Cold starts, API rate limits, complex error handling</li>
<li>Example Stack: Vercel/Netlify + Hugging Face API</li>
</ul>
</section>
<section id="browser-extension" class="level3" data-number="5.4.4">
<h3 data-number="5.4.4" class="anchored" data-anchor-id="browser-extension"><span class="header-section-number">5.4.4</span> Browser Extension</h3>
<p>We could also implement a flywheel that relies on users downloading a browser extension. This only reflects a data ingestion choice: can be used with various backend choices above.</p>
<p>The browser extension could faciliate: - direct contributions to a database - wrapper on top of git-style actions (i.e.&nbsp;instead of a web app that helps users write to a git-repo via the HuggingFace API, have a browser extension that does so!)</p>
</section>
<section id="federated-learning-model" class="level3" data-number="5.4.5">
<h3 data-number="5.4.5" class="anchored" data-anchor-id="federated-learning-model"><span class="header-section-number">5.4.5</span> Federated Learning Model</h3>
<p>One radically different approach might involve building a flywheel that contributes information via a federated learning. In this world, the flywheel is not actually about sharing raw data directly, but instead about sharing model weights.</p>
<ul>
<li>Where data lives: User devices (distributed)</li>
<li>When prompted: Passive with consent</li>
<li>Information object: Model gradients or aggregated statistics</li>
<li>When processed: Pre-submission (on-device)</li>
<li>How accessed: Only aggregated model updates available</li>
<li>Friction level: Zero after setup</li>
<li>Pros: Maximum privacy, no data transfer, infinite scale</li>
<li>Cons: Complex implementation, limited debugging, device requirements</li>
</ul>
</section>
<section id="other-experimental-approaches" class="level3" data-number="5.4.6">
<h3 data-number="5.4.6" class="anchored" data-anchor-id="other-experimental-approaches"><span class="header-section-number">5.4.6</span> Other experimental approaches</h3>
<p>Other approaches to building a flywheel might involve more radical approaches to decentralizing the actual data storage, for instance using peer to peer protocols, various crypto/web3 approaches to data sovereignty, etc.</p>
</section>
</section>
<section id="frontier-approaches-data-cooperatives-federated-learning-and-more" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="frontier-approaches-data-cooperatives-federated-learning-and-more"><span class="header-section-number">5.5</span> Frontier approaches: data cooperatives, federated learning, and more</h2>
<p>#todo: this could be made crisper.</p>
<p>In many cases, users may want to have data governed by community organizations (e.g., organized by domain/region/language) that hold rights and decide release cadence, licensing defaults, and benefit policies.</p>
<p>Practically, taking a collective/intermediary focused approach has the potential to massively reduce user friction / attention costs. One vision for a low friction data intermediary approach is: users spend some time, say, once a year choosing which intermediaries to join. Upon joining, they can choose to delegate key decision-making and participate in intermediary governance as suits their desires and needs. If joining process is good + governance is good, can achieve good outcomes!</p>
<p>We note that if an implementation of the flywheel is built on top of open-source software, communities can easily choose to deploy their own instance and their own data flywheel and effectively operate entirely parallel, self-governed instances. If they also choose to share opt-in data via similar licensing and preference signal approaches, such datasets could be easily merged ‚Äì but with fine-grained adjustments to precise details (e.g., slight modifications on retention, access, release cadence, content moderation, adn so on.) Of course, data co-ops may choose to use quite different technical stacks. This approach is just one among many.</p>
<section id="interactions-between-these-flywheels" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="interactions-between-these-flywheels"><span class="header-section-number">5.5.1</span> Interactions between these flywheels</h3>
<p>#todo</p>
</section>
<section id="transitioning-for-opt-in-flywheel-to-federated-learning" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="transitioning-for-opt-in-flywheel-to-federated-learning"><span class="header-section-number">5.5.2</span> Transitioning for opt-in flywheel to federated learning</h3>
<p>It may be possible to also move from an opt-in data flywheel approach to a federated learning-first approach. Here, model training occurs across user or institutional nodes; only gradients/updates (with privacy tech) are centralized. The dataset remains partitioned or local; central custodian minimized. This approach would:</p>
<ul>
<li>Reduces central data custody and breach surface</li>
<li>Aligns with data-residency and institutional constraints</li>
<li>Enables ‚Äúlearning from data that can‚Äôt leave‚Äù</li>
</ul>
<p>But has some major downsides / existing barriers:</p>
<ul>
<li>Harder reproducibility and data auditability</li>
<li>Complex privacy stack (secure aggregation, DP, client attestation)</li>
<li>Benchmarking must be redesigned (federated eval)</li>
</ul>
<p>This is a bigger leap, but we believe it‚Äôs important to begin to think about how the implementation of the Public AI Data Flywheels might support communities wishing to transition towards an FL approach.</p>
<p>One rough sketch might look like: * Build the MVP defined in Chapter 2 * Ship license + AI-preference metadata (MVP). * Maintain gated HF releases and public leaderboards/full data access. * Publish provider-payload transparency and link to provider terms (no guarantees). * Process deletions via HF mechanisms when possible; keep our mirrors in sync. * Phase 1 ‚Äî Co-op pilots * Charter one or two community co-ops; define bylaws, scope, and release cadence. * Spin up many instances of interface + flywheel combos (can fork software directly, or use similar approaches) * Establish a concrete sharing / merging plan * And beyond! * Once several independent data communities, are operated, it might be possible to move from lightweight sharing and merging to more serious federation with technical guarantees. Perhaps this might start with federated evaluation and then move to federated training. Much more to do here, out of scope for this document.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01d_leverage.html" class="pagination-link  aria-label=" &lt;span="" and="" bargaining="" power&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Flywheels and Bargaining Power</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./01f_ethics_compliance.html" class="pagination-link" aria-label="<span class='chapter-number'>6</span>&nbsp; <span class='chapter-title'>Ethics and Compliance</span>">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ethics and Compliance</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>